# Copyright 2025 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#      http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

apiVersion: blueprints.cloud.google.com/v1alpha1
kind: BlueprintMetadata
metadata:
  name: terraform-google-regional-lb-http-backend-display
  annotations:
    config.kubernetes.io/local-config: "true"
spec:
  info:
    title: HTTP Regional Load balancer backend module
    source:
      repo: https://github.com/googlestaging/terraform-google-regional-lb-http.git
      sourceType: git
      dir: /modules/backend
  ui:
    input:
      variables:
        affinity_cookie_ttl_sec:
          name: affinity_cookie_ttl_sec
          title: Affinity Cookie Ttl Sec
          min: 0
          max: 86400
        connection_draining_timeout_sec:
          name: connection_draining_timeout_sec
          title: Connection Draining Timeout Sec
          min: 0
          max: 3600
        description:
          name: description
          title: Description
        enable_cdn:
          name: enable_cdn
          title: Enable Cdn
        firewall_networks:
          name: firewall_networks
          title: Firewall Networks
          regexValidation: "^(projects/[a-z][a-z0-9-]{4,28}[a-z0-9]/global/networks/[a-zA-Z0-9-_]+|[a-zA-Z0-9-_]+)$"
          validation: Network must be a valid network name or a full resource path.
        firewall_projects:
          name: firewall_projects
          title: Firewall Projects
          regexValidation: ^[a-z][a-z0-9-]{4,28}[a-z0-9]$
          validation: Project ID must be 6 to 30 characters, consist of lowercase letters, numbers, and hyphens, and start with a letter
        firewall_source_ranges:
          name: firewall_source_ranges
          title: Firewall Source Ranges
          regexValidation: "^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9]).){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])/([0-9]|[1-2][0-9]|3[0-2])$"
          validation: Must be a valid CIDR range
        groups:
          name: groups
          title: Groups
          properties:
            balancing_mode:
              name: balancing_mode
              title: Balancing Mode
              enumValueLabels:
                - label: CONNECTION
                  value: CONNECTION
                - label: RATE
                  value: RATE
                - label: UTILIZATION
                  value: UTILIZATION
                - label: CUSTOM_METRICS
                  value: CUSTOM_METRICS
            capacity_scaler:
              name: capacity_scaler
              title: Capacity Scaler
              min: 0.0
              max: 1.0
            max_utilization:
              name: max_utilization
              title: Max Utilization
              min: 0.0
              max: 1.0
        health_check:
          name: health_check
          title: Health Check
          properties:
            host:
              name: host
              title: Host
              regexValidation: "^(([a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?[.])+[a-zA-Z]{2,63}|[0-9]{1,3}([.][0-9]{1,3}){3}|(\\[?[A-Fa-f0-9:]+\\]?))$"
              validation: Must be a valid hostname (RFC 1035), IPv4 address, or IPv6 address
            request_path:
              name: request_path
              title: Request Path
              regexValidation: "^/.*$"
              validation: Must start with a forward slash `/` and can include any valid path characters.
            request:
              name: request
              title: Request
              regexValidation: "^[ -~]*$"
              validation: Must contain only ASCII characters
            response:
              name: response
              title: Response
              regexValidation: "^[ -~]*$"
              validation: Must contain only ASCII characters
            port:
              name: port
              title: Port
              min: 1
              max: 65535
            port_name:
              name: port_name
              title: Port Name
              regexValidation: ^[a-z]([-a-z0-9]{0,61}[a-z0-9])?$
              validation: Must start with a lowercase letter, contain only lowercase letters, digits, or hyphens, and end with a letter or digit
            proxy_header:
              name: proxy_header
              title: Proxy Header
              enumValueLabels:
                - label: NONE
                  value: NONE
                - label: PROXY_V1
                  value: PROXY_V1
            port_specification:
              name: port_specification
              title: Port Specification
              enumValueLabels:
                - label: USE_FIXED_PORT
                  value: USE_FIXED_PORT
                - label: USE_NAMED_PORT
                  value: USE_NAMED_PORT
                - label: USE_SERVING_PORT
                  value: USE_SERVING_PORT
            protocol:
              name: protocol
              title: Protocol
              enumValueLabels:
                - label: HTTP
                  value: HTTP
                - label: HTTPS
                  value: HTTPS
                - label: HTTP2
                  value: HTTP2
                - label: TCP
                  value: TCP
            check_interval_sec:
              name: check_interval_sec
              title: Check Interval Sec
              min: 1
              max: 300
            timeout_sec:
              name: timeout_sec
              title: Timeout Sec
              min: 1
              max: 300
            healthy_threshold:
              name: healthy_threshold
              title: Healthy Threshold
              min: 1
              max: 10
            unhealthy_threshold:
              name: unhealthy_threshold
              title: Unhealthy Threshold
              min: 1
              max: 10
        host_path_mappings:
          name: host_path_mappings
          title: Host Path Mappings
          level: 1
        iap_config:
          name: iap_config
          title: Iap Config
          properties:
            iap_members:
              name: iap_members
              title: Iap Members
              regexValidation: ^(?:allUsers|allAuthenticatedUsers)$|^((?:user|group|serviceAccount):(?:[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,})|(?:domain:(?:[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,})|(?:projectOwner|projectEditor|projectViewer):[a-z][a-z0-9-]{0,28}[a-z0-9])$
              validation: Must be allUsers, allAuthenticatedUsers, or a service account in the format serviceAccount:email@example.com. [More info](https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/iap_web_region_backend_service_iam#google_iap_web_region_backend_service_iam_member).
        load_balancing_scheme:
          name: load_balancing_scheme
          title: Load Balancing Scheme
          enumValueLabels:
            - label: EXTERNAL_MANAGED
              value: EXTERNAL_MANAGED
            - label: INTERNAL_MANAGED
              value: INTERNAL_MANAGED
          level: 1
        locality_lb_policy:
          name: locality_lb_policy
          title: Locality Lb Policy
          enumValueLabels:
            - label: ROUND_ROBIN
              value: ROUND_ROBIN
            - label: LEAST_REQUEST
              value: LEAST_REQUEST
            - label: RING_HASH
              value: RING_HASH
            - label: RANDOM
              value: RANDOM
            - label: ORIGINAL_DESTINATION
              value: ORIGINAL_DESTINATION
            - label: MAGLEV
              value: MAGLEV
            - label: WEIGHTED_MAGLEV
              value: WEIGHTED_MAGLEV
            - label: WEIGHTED_ROUND_ROBIN
              value: WEIGHTED_ROUND_ROBIN
        name:
          name: name
          title: Name
          regexValidation: ^[a-z][a-z0-9-]{0,36}[a-z0-9]$
          validation: Use lowercase letters, numbers, and hyphens. Start with a letter and end with letter/number. Must be 38 characters or fewer.
        port_name:
          name: port_name
          title: Port Name
          regexValidation: ^[a-z]([-a-z0-9]{0,61}[a-z0-9])?$
          validation: Must start with a lowercase letter, contain only lowercase letters, digits, or hyphens, and end with a letter or digit
        project_id:
          name: project_id
          title: Project Id
        protocol:
          name: protocol
          title: Protocol
          enumValueLabels:
            - label: HTTP
              value: HTTP
            - label: HTTPS
              value: HTTPS
            - label: HTTP2
              value: HTTP2
            - label: TCP
              value: TCP
        region:
          name: region
          title: Region
        security_policy:
          name: security_policy
          title: Security Policy
          regexValidation: ^(projects/[a-z][a-z0-9-]{4,28}[a-z0-9]/global/securityPolicies/[a-z0-9-]+|[a-z0-9-]+)$"
          validation: Must be a valid security policy name or full resource path in the format "projects/{project}/global/securityPolicies/{policy}"
        serverless_neg_backends:
          name: serverless_neg_backends
          title: Serverless Neg Backends
          properties:
            capacity_scaler:
              name: capacity_scaler
              title: Capacity Scaler
              min: 0.0
              max: 1.0
            type:
              name: type
              title: Type
              enumValueLabels:
                - label: Cloud Run
                  value: cloud-run
                - label: Cloud Function
                  value: cloud-function
                - label: App Engine
                  value: app-engine
            service_name:
              name: service_name
              title: Service Name
              regexValidation: ^[a-z]([-a-z0-9]{0,61}[a-z0-9])?$
              validation: Must be a valid service name (lowercase, hyphens, numbers, up to 63 chars).
        session_affinity:
          name: session_affinity
          title: Session Affinity
          enumValueLabels:
            - label: NONE
              value: NONE
            - label: CLIENT_IP
              value: CLIENT_IP
            - label: CLIENT_IP_PORT_PROTO
              value: CLIENT_IP_PORT_PROTO
            - label: CLIENT_IP_PROTO
              value: CLIENT_IP_PROTO
            - label: CLIENT_IP_NO_DESTINATION
              value: CLIENT_IP_NO_DESTINATION
            - label: GENERATED_COOKIE
              value: GENERATED_COOKIE
            - label: HEADER_FIELD
              value: HEADER_FIELD
            - label: HTTP_COOKIE
              value: HTTP_COOKIE
            - label: STRONG_COOKIE_AFFINITY
              value: STRONG_COOKIE_AFFINITY
        target_service_accounts:
          name: target_service_accounts
          title: Target Service Accounts
          regexValidation: ^[a-z][a-z0-9-]{4,28}[a-z0-9]@[a-z][a-z0-9-]{4,28}[a-z0-9].iam.gserviceaccount.com$
          validation: Service account email must be in the format {account-id}@{project-id}.iam.gserviceaccount.com
        target_tags:
          name: target_tags
          title: Target Tags
        timeout_sec:
          name: timeout_sec
          title: Timeout Sec
          min: 1
          max: 2147483647
